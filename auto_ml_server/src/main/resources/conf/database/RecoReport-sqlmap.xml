<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="RecoReportDAO">

	<!--  전체 추천 유형별 전환율   -->
	<select id="selectTotalRecoRate" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT   DATE  
		     ,  LAYOUT  
		     <!-- ,  SUM(RECOSUCCESS) AS RECOSUCCESS
		     ,  SUM(ENROLLMENT) AS ENROLLMENT -->
			 , CONVERT(NUMERIC(5,2), ROUND(convert(FLOAT, SUM(RECOSUCCESS)) / SUM(ENROLLMENT) * 100, 2)) AS RECO_RATE
		  FROM  RECO_REPORT  
		  WHERE DATE BETWEEN #START_DATE# AND #END_DATE#
	  	  GROUP BY DATE, LAYOUT
		  ORDER BY DATE, LAYOUT
	</select>
	
	<!-- 일자별 현황 -->
	<select id="selectRecoRateByDate" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT   DATE  
		      ,  SUM(RECOSUCCESS) AS RECOSUCCESS
		      ,  SUM(ENROLLMENT) AS ENROLLMENT
			  , CONVERT(NUMERIC(10,2), ROUND(convert(FLOAT, SUM(RECOSUCCESS)) / SUM(ENROLLMENT) * 100, 2)) AS RECO_RATE
		  FROM   RECO_REPORT  
		  WHERE DATE BETWEEN #START_DATE# AND #END_DATE#
	  	    AND LAYOUT = #LAYOUT#
		  GROUP BY DATE
		  ORDER BY DATE
	</select>
	
	<!-- 수강신청수 -->
	<select id="selectEnrollCount" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	SELECT DATE  
		,  SUM(RECOSUCCESS) AS RECOSUCCESS
		,  SUM(ENROLLMENT) AS ENROLLMENT 
		, CONVERT(NUMERIC(5,2), ROUND(convert(FLOAT, SUM(RECOSUCCESS)) / SUM(ENROLLMENT) * 100, 2)) AS RECO_RATE
	  FROM RECO_REPORT 
	 WHERE DATE BETWEEN #START_DATE# AND #END_DATE#
	   AND LAYOUT = #LAYOUT#
	 GROUP BY DATE
	 ORDER BY DATE
	</select>
	
	<!-- 영역별 전환율  -->
	<select id="selectRecoRateTop5ByArea" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	SELECT TOP 5 AREA  
		 , CONVERT(NUMERIC(5,2), ROUND(convert(FLOAT, SUM(RECOSUCCESS)) / SUM(ENROLLMENT) * 100, 2)) AS RECO_RATE
	  FROM RECO_REPORT 
	 where LAYOUT = #LAYOUT#
	 GROUP BY AREA
	 ORDER BY RECO_RATE DESC
	</select>
	
	<!-- 선생님별 전환율  -->
	<select id="selectRecoRateTop5ByTeacher" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT TOP 5 TEACHER  
			 , CONVERT(NUMERIC(5,2), ROUND(convert(FLOAT, SUM(RECOSUCCESS)) / SUM(ENROLLMENT) * 100, 2)) AS RECO_RATE
		  FROM RECO_REPORT 
	     where LAYOUT = #LAYOUT#
		 GROUP BY TEACHER
		 ORDER BY RECO_RATE DESC
	</select>
	
	<!-- 최근 날짜 -->
	<select id="selectMaxDate" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	SELECT TOP 1 DATE 
	  FROM RECO_REPORT 
	 ORDER BY DATE DESC
 	</select>

</sqlMap>