<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SqlListDAO">

	<select id="selectListForSqlListTree" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		/* SqlListDAO.selectListForSqlListTree */
		SELECT
			id
			, text
			, children
			, type
			, ord1
			, ord2
			, SQL_ID
			, SQL_NM
			, FLD_ID
		FROM (
			SELECT
				'T' + CAST(FLD_ID AS CHAR(50)) AS id
				, FLD_NM AS text
				, CONVERT(
					BIT
					, (SELECT COUNT(*) FROM WP2_TYPE_DATASET_MSTR WHERE FLD_PARENT_ID = A.FLD_ID)
						+ (SELECT COUNT(*) FROM WP2_SQL_LIST WHERE FLD_ID = A.FLD_ID)
					) AS children
				, 'typeSql' AS type
				, 1 AS ord1
				, FLD_ORDINAL as ord2
				,NULL AS SQL_ID
				,NULL AS SQL_NM
				,NULL AS FLD_ID
			FROM WP2_TYPE_DATASET_MSTR A
			WHERE FLD_PARENT_ID = #FLD_PARENT_ID#
			UNION ALL
			SELECT
				CAST(B.SQL_ID AS CHAR(50)) AS id
				, B.SQL_NM AS text
				, CONVERT(BIT, 0) AS children
				, 'sql' AS type
				, 2 AS ord1
				, ROW_NUMBER() OVER (ORDER BY SQL_ID)   as ord2
				,B.SQL_ID
				,B.SQL_NM
				,B.FLD_ID
			FROM WP2_SQL_LIST B
			WHERE B.FLD_ID = #FLD_PARENT_ID#
		) AS C
		ORDER BY ord1, ord2
	</select>
	
	<select id="select" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		/* SqlListDAO.select */
			SELECT
				  B.SQL_ID
				,B.SQL_NM
				,B.FLD_ID
				,SQL_DESC
				,dbo.F_DECRYPT(SQL_QUERY) as SQL_QUERY
			FROM WP2_SQL_LIST B
			WHERE B.SQL_ID = #SQL_ID#
	</select>
	<select id="vaild" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		/* SqlListDAO.vaild*/
			BEGIN TRANSACTION
			$SQL$
			ROLLBACK TRANSACTION
	</select>
	<select id="vaild2" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		/* SqlListDAO.vaild*/
			BEGIN TRAN
			$SQL$
			ROLLBACK TRAN
	</select>
	
</sqlMap>