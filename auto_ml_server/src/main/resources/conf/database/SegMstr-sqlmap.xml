<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="SegMstrDAO">
 	
 	
 	<select id="selectList" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT A.SEG_ID
	      ,A.SEG_NM
	      ,A.FLD_ID
		   ,B.FLD_NM
	      ,A.SEG_STATUS
	      ,dbo.F_CODE_NM('SEG_STATUS', A.SEG_STATUS) AS SEG_STATUS_NM
	      ,A.SEG_ALG
	      ,A.SEG_DESC
	      ,A.IU_TYPE
		  ,A.SEG_TYPE
		  ,dbo.F_CODE_NM('IU_TYPE', A.IU_TYPE) AS IU_TYPE_NM
	      ,dbo.F_CODE_NM('SEG_TYPE', A.SEG_TYPE) AS SEG_TYPE_NM
	      ,A.DESIGN_KEY_VALUE
	      ,dbo.F_DECRYPT(A.SEG_XML) AS SEG_XML
	      ,dbo.F_DECRYPT(A.SEG_SQL) AS SEG_SQL
	      ,A.DEL_YN
	      ,A.USE_YN
	      ,A.USE_YN as OLD_USE_YN
	      ,'' as STATUS_NM
	      ,A.ORDINAL
	      ,A.REG_USER_NO
	      ,A.REG_DT
	      ,A.UPD_USER_NO
	      ,A.UPD_DT
		  <!-- ,dbo.F_DECRYPT(SEG_SQL)
		  ,dbo.F_DECRYPT(SEG_XML)-->
  		FROM WP2_SEG_MSTR A JOIN WP2_TYPE_SEG_MSTR B ON A.FLD_ID = B.FLD_ID
  		WHERE 1=1
  		<isNotEmpty property="FLD_ID">
		  AND A.FLD_ID = #FLD_ID#
		</isNotEmpty>
		<isNotEmpty property="USE_YN">
		  AND A.USE_YN = #USE_YN#
		</isNotEmpty>
		  AND A.DEL_YN = 'N' 
		  ORDER BY A.FLD_ID, A.ORDINAL 
	</select>
	
	<!-- 암호화 
		  ,dbo.F_ENCRYPT(SEG_SQL)
		  ,dbo.F_ENCRYPTSEG_XML) -->
	<!-- <update>
	</update> -->
	
	<!-- 수정 -->
	<!--update id="update" parameterClass="java.util.HashMap">
		UPDATE
			WP2_SEG_MSTR
		SET
			SEG_NM = #SEG_NM#
			,FLD_ID = #FLD_ID#
			,SEG_ALG = #SEG_ALG#
			,SEG_DESC = #SEG_DESC#
			,IU_TYPE = #IU_TYPE#
			,DESIGN_KEY_VALUE = #DESIGN_KEY_VALUE#
			,SEG_XML = #SEG_XML#
			,SEG_SQL = #SEG_SQL#
			,DEL_YN = #DEL_YN#
			,ORDINAL = #ORDINAL#
			,SEG_STATUS = #SEG_STATUS#
			,REG_USER_NO = #REG_USER_NO#
			,REG_DT = #REG_DT#
			,UPD_USER_NO = #UPD_USER_NO#
			,UPD_DT = #UPD_DT#
		WHERE
			SEG_ID = #SEG_ID#
	</update-->
	
	<!-- 수정 -->
	<update id="update" parameterClass="java.util.HashMap">
		UPDATE
			WP2_SEG_MSTR
		SET
			SEG_NM = #SEG_NM#
			,FLD_ID = #FLD_ID#
			,SEG_TYPE = #SEG_TYPE#
			,IU_TYPE = #IU_TYPE#
			,SEG_DESC = #SEG_DESC#
			,SEG_STATUS = #SEG_STATUS#
			,ORDINAL = #ORDINAL#
			,DESIGN_KEY_VALUE = #DESIGN_KEY_VALUE#
			,SEG_XML = dbo.F_ENCRYPT(#SEG_XML#)
			,SEG_SQL = dbo.F_ENCRYPT(#SEG_SQL#)
			,UPD_USER_NO = #USER_NO#
			,UPD_DT = NOW()
		WHERE
			SEG_ID = #SEG_ID#
	</update>
	<!-- 선택여부 수정 -->
	<update id="updateUseYn" parameterClass="java.util.HashMap">
		UPDATE
			WP2_SEG_MSTR
		SET USE_YN = #USE_YN#
			,UPD_USER_NO = #USER_NO#
			,UPD_DT = NOW()
		WHERE
			SEG_ID = #SEG_ID#
	</update>
	
	<!-- 삭제 -->
	<update id="delete" parameterClass="java.util.HashMap">
		UPDATE
			WP2_SEG_MSTR
		SET
			DEL_YN = 'Y'
			,UPD_USER_NO = #USER_NO#
			,UPD_DT = NOW()
		WHERE
			SEG_ID = #SEG_ID#
	</update>
	
	<insert id="insert" parameterClass="java.util.Map">
		INSERT INTO WP2_SEG_MSTR
           ( SEGDA_ID
            ,SEG_NO
            ,SEG_NM
			,FLD_ID
			,SEG_ALG
			,SEG_DESC
			,SEG_TYPE
			,IU_TYPE
			,DESIGN_KEY_VALUE
			,SEG_XML
			,SEG_SQL
			,USE_YN
			,DEL_YN
			,ORDINAL
			,SEG_STATUS
			,REG_USER_NO
			,REG_DT
           )
     VALUES
           (#SEGDA_ID#
            ,#SEG_NO#
            ,#SEG_NM#
			,#FLD_ID#
			,#SEG_ALG#
			,#SEG_DESC#
			,#SEG_TYPE#
			,#IU_TYPE#
			,#DESIGN_KEY_VALUE#
			,dbo.F_ENCRYPT(#SEG_XML#)
			,dbo.F_ENCRYPT(#SEG_SQL#)
			,isnull(#USE_YN#, 'N')
			,isnull(#DEL_YN#, 'N')
			,#ORDINAL#
			,#SEG_STATUS#
			,#USER_NO#
			,NOW()
           )
		<selectKey keyProperty="SEG_ID" resultClass="Integer">
			SELECT ident_current('WP2_SEG_MSTR')
		</selectKey>
	</insert>

 	<select id="selectListBySegNm" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT A.SEG_ID
	      ,A.SEG_NM
	      ,A.FLD_ID
		   ,B.FLD_NM
	      ,A.SEG_STATUS
	      ,dbo.F_CODE_NM('SEG_STATUS', A.SEG_STATUS) AS SEG_STATUS_NM
	      ,A.SEG_ALG
	      ,A.SEG_DESC
	      ,A.IU_TYPE
		  ,dbo.F_CODE_NM('IU_TYPE', A.IU_TYPE) AS IU_TYPE_NM
	      ,A.DESIGN_KEY_VALUE
	      ,A.SEG_XML
	      ,A.SEG_SQL
	      ,A.DEL_YN
	      ,A.ORDINAL
	      ,A.REG_USER_NO
	      ,A.REG_DT
	      ,A.UPD_USER_NO
	      ,A.UPD_DT
		  <!-- ,dbo.F_DECRYPT(SEG_SQL)
		  ,dbo.F_DECRYPT(SEG_XML)-->
  		FROM WP2_SEG_MSTR A JOIN WP2_TYPE_SEG_MSTR B ON A.FLD_ID = B.FLD_ID
  		WHERE 1=1
		  AND A.SEG_NM = #SEG_NM#
		  AND A.DEL_YN = 'N'
	</select>

	<select id="selectMaxOrdinalByFldId" parameterClass="java.util.Map"  resultClass="int">
		SELECT isnull(MAX(ORDINAL), 0) + 1 as ORDINAL
		  FROM WP2_SEG_MSTR 
		 WHERE FLD_ID = #FLD_ID#
		   AND DEL_YN = 'N'
	</select>
	
	<!-- 메인통계 - 세그먼트 수  -->
	<select id="selectTotalSegGount" parameterClass="java.util.Map" resultClass="int">
	SELECT COUNT(DISTINCT SEG_ID) AS SEG_CNT
	  FROM WP2_SEG_MSTR
	 WHERE USE_YN = 'Y'
	   AND DEL_YN = 'N'
	</select>
</sqlMap>